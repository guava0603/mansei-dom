<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>飲食紀錄</title>
</head>

<body style="border: none;"">
    <form action="" style="margin: 10px; display: flex; flex-direction: column; align-items: center; border: none;">
        <!-- <label>日期</label>
        <input type="date" id="datetime" value="" class="form-control" /> <br /> -->
        <div style="width: 90vw; display: flex;flex-direction: column;align-items: flex-start; border: none;">
            <label style="color: #435334; font-size: 4vw; font-weight: 700;">食物</label>
            <input style="width: 100%; min-height: 6vw;" type="text" id="food" class="form-control" />
        </div>
        <br />
        <div style="width: 90vw; display: flex;flex-direction: column;align-items: flex-start; border: none;">
            <label style="color: #435334; font-size: 4vw; font-weight: 700;">感受與症狀</label>
            <input style="width: 100%; min-height: 6vw;" type="text" id="sympton" class="form-control" />
        </div>
        <br />
        <div style="font-size: 3vw; font-weight: 700; align-self: flex-start; background-color: #CEDEBD; color: #435334; padding: 10px 5vw; border-radius: 5px;" class="btn btn-success btn-block" id="sure" onclick="sure()">確定</div>
    </form>
    <hr>
    <style>
        input {
            border: none;
            background-color: #FAF1E4;
        }
    </style>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script>
        function initializeLiff(myLiffId) {
            liff
                .init({
                    liffId: myLiffId
                })
                .then(() => {
                    // start to use LIFF's api
                    // initializeApp();
                    language = liff.getLanguage(); // String。引用 LIFF SDK 的頁面，頁面中的 lang 值
                    version = liff.getVersion(); // String。LIFF SDK 的版本
                    isInClient = liff.isInClient(); // Boolean。回傳是否由 LINE App 存取
                    isLoggedIn = liff.isLoggedIn(); // Boolean。使用者是否登入 LINE 帳號。true 時，可呼叫需要 Access Token 的 API
                    os = liff.getOS(); // String。回傳使用者作業系統：ios、android、web
                    lineVersion = liff.getLineVersion(); // 使用者的 LINE 版本

                    if(!isLoggedIn) {
                        liff.login({
                            redirectUri: 'https://6e36-118-9-104-244.ngrok-free.app/page'
                        });
                    }
                })
                .catch((err) => {
                    alert(err);
                });
        }

        function sure() {
            const food = document.getElementById('food');
            const sympton = document.getElementById('sympton');
            let message = '';
            if (!food.value) {
                window.alert('請填寫「食物」欄位');
                return;
            }
            if (!sympton.value) sympton.value = '無';

            const noww = new Date();
            const year = noww.getFullYear();
            const month = noww.getMonth()+1;
            const date = noww.getDate();
            const hour = noww.getHours();
            const minute = noww.getMinutes();
            const time = year + '/' + month + '/' + date + '/' + ' ' + hour + ':' + minute
            const msg = "時間：" + time + "\n食物：" + food.value + '\n症狀：' + sympton.value
            liff.sendMessages([{
                'type': 'text',
                'text': msg
            }]).then(function () {
                // window.alert('Message sent');
                liff.closeWindow();
            }).catch(function (error) {
                window.alert('資料傳送失敗: ' + error);
                // liff.closeWindow();
            });
        }

        window.onload = () => {
            initializeLiff('2000498096-XzeBzlB5');
        }

    </script>
</body>

</html>